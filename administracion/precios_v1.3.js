$(document).ready(function(){muestra_convenios();});function muestra_convenios(){$("#contenedor_error").css("display","none");$("#txtParametro").val("");var _1="opcion=1&parametro=-5";llamarAjax("precios_ajax.php",_1,"principal_convenios","");};function seleccionar_convenio(_2,_3){var _4="opcion=2&idConvenio="+_2+"&idEcopetrol="+_3;llamarAjax("precios_ajax.php",_4,"principal_convenios","");};function buscarConvenio(){$("#frmBuscarConvenio").validate({rules:{txtParametro:{required:true,},},submitHandler:function(){var _5=$("#txtParametro").val();var _6="opcion=1&parametro="+_5;llamarAjax("precios_ajax.php",_6,"principal_convenios","");return false;},});};function resetServicio(){$("#cmb_tipo_servicio").val("0");$("#resultado").html("");};function listasPrecios(){var _7=$("#cmb_tipo_servicio").val();var _8=$("#cmb_plan").val();var _9="1";var _a="";if(isObject(document.getElementById("txtParametroPrecios"))){_a=$("#txtParametroPrecios").val();}if(_8==""){alert("Seleccione el Plan");}else{var _b="opcion=3&parametro="+_7+"&idPlan="+_8+"&accion="+_9+"&txtBuscar="+_a;llamarAjax("precios_ajax.php",_b,"resultado","");}};function buscarPrecio(){$("#frmListadoPrecios").validate({rules:{txtParametroPrecios:{required:true,},},submitHandler:function(){var _c=$("#cmb_tipo_servicio").val();var _d=$("#cmb_plan").val();var _e="2";var _f=$("#txtParametroPrecios").val();if(_d==""){alert("Seleccione el Plan");}else{var _10="opcion=3&parametro="+_c+"&idPlan="+_d+"&accion="+_e+"&txtBuscar="+_f;llamarAjax("precios_ajax.php",_10,"resultado","");}return false;},});};function ver_historia_precios(_11,_12,_13){$("#contenedor_error").remove();$("#fondo_negro_agregar_servicios").css("display","block");$("#d_centro_agregar_servicios").slideDown(400).css("display","block");$("#d_interno_agregar_servicios").css("height","470");var _14=$("#cmb_plan").val();var _15=$("#cmb_tipo_servicio").val();var _16=$("#hdd_nombre_convenio").val();var _17="opcion=8&cod_procedimiento="+_12+"&id_plan="+_14+"&tipo_servicio="+_15+"&nombre_convenio="+_16+"&tipo_bilateral="+_13;llamarAjax("precios_ajax.php",_17,"d_interno_agregar_servicios","");};function abrir_agregar_precios(_18,_19){$("#contenedor_error").remove();$("#fondo_negro_agregar_servicios").css("display","block");$("#d_centro_agregar_servicios").slideDown(400).css("display","block");$("#d_interno_agregar_servicios").css("height","470");var _1a=$("#cmb_tipo_servicio").val();var _1b="opcion=4&tipoServicio="+_1a+"&idPrecio="+idPrecio;};function ventanaAgregarPrecio(_1c,_1d){if(_1c==1||_1c==2){$("#contenedor_error").remove();$("#fondo_negro_agregar_servicios").css("display","block");$("#d_centro_agregar_servicios").slideDown(400).css("display","block");$("#d_interno_agregar_servicios").css("height","470");var _1e=$("#cmb_tipo_servicio").val();var _1f="opcion=4&tipoServicio="+_1e+"&idPrecio="+_1d+"&tipo_accion="+_1c;llamarAjax("precios_ajax.php",_1f,"d_interno_agregar_servicios","");}else{if(_1c==0){$("#d_centro_agregar_servicios").css("display","none");$("#fondo_negro_agregar_servicios").css("display","none");$("#advertenciasg").prepend("<div class=\"contenedor_error\" id=\"contenedor_error\"></div>");}}};function ventanaServicios(_20){if(_20==1){$("#contenedor_error").remove();$("#fondo_negro_servicios").css("display","block");$("#d_centro_servicios").slideDown(400).css("display","block");$("#d_interno_servicios").css({"min-height":"470px"});var _21=$("#idServicio").val();var _22="opcion=5&tipoServicio="+_21;llamarAjax("precios_ajax.php",_22,"d_interno_servicios","");}else{if(_20==0){$("#d_centro_servicios").css("display","none");$("#fondo_negro_servicios").css("display","none");$("#advertenciasAgregarPrecio").prepend("<div class=\"contenedor_error\" id=\"contenedor_error\"></div>");}}};function AgregarPrecio(){$("#frmAgregarPrecio").validate({rules:{fechaInicial:{required:true,},txtValorTotal:{required:true,number:true},txtValorCuota:{required:true,number:true},},submitHandler:function(){var _23=$("#hdd_idServicio").val();var _24=$("#idPrecio").val();if(_23=="0"&&_24=="0"){alert("Seleccione el Servicio");}else{if(_23!=""){var _25=$("#fechaInicial").val();var _26=$("#fechaFinal").val();var _27="";if(_26!=""){_26=_26.split("/");_27=_26[2]+"-"+_26[1]+"-"+_26[0];}else{_26=_26.split("/");}_25=_25.split("/");var _28=new Date();var _29=new Date();_28.setFullYear(_25[2],_25[1],_25[0]);_29.setFullYear(_26[2],_26[1],_26[0]);if(_28>_29){alert("Fecha inicial no debe ser mayor a fecha final");}else{var _2a=$("#cmb_plan").val();var _2b=$("#idServicio").val();var _2c=$("#cmb_tipo_bilateral").val();var _2d=$("#txtValorTotal").val();var _2e=$("#txtValorCuota").val();var _2f="opcion=7&codigoServicioSeleccionado="+_23+"&idPrecio="+_24+"&fechaInicial="+_25[2]+"-"+_25[1]+"-"+_25[0]+"&fechaFinal="+_27+"&tipoServicio="+_2b+"&plan="+_2a+"&tipoBilateral="+_2c+"&txtValorTotal="+_2d+"&txtValorCuota="+_2e;llamarAjax("precios_ajax.php",_2f,"rtaAgregarPrecio","verificaGuardarPrecio();");}}}return false;},});};function crear_precios(){if(validar_crear_precios()==0){var _30=$("#hdd_idServicio").val();var _31=$("#idPrecio").val();var _32=$("#cmb_plan").val();var _33=$("#idServicio").val();var _34=$("#cmb_tipo_bilateral").val();var _35=$("#txtValorTotal").val();var _36=$("#txtValorCuota").val();var _37=$("#fecha_final_anterior").val();var _38=$("#fecha_final_anterior").val().split("/");_38=new Date(_38[2],_38[1],_38[0]);var _39=$("#fechaInicial").val();var _3a=$("#fechaInicial").val().split("/");_3a=new Date(_3a[2],_3a[1],_3a[0]);var _3b=$("#fechaFinal").val();var _3c=$("#fechaFinal").val().split("/");_3c=new Date(_3c[2],_3c[1],_3c[0]);var _3d=$("#fecha_hoy").val();var _3e=$("#fecha_hoy").val().split("/");_3e=new Date(_3e[2],_3e[1],_3e[0]);if(Date.parse(_3a)>Date.parse(_3c)){alert("Fecha inicial no debe ser mayor a fecha final");return false;}if(Date.parse(_3a)<Date.parse(_38)){alert("La fecha inicial se cruza con el rango de fechas del precio anterior");return false;}var _3f="opcion=9&codigoServicioSeleccionado="+_30+"&idPrecio="+_31+"&fechaInicial="+_39+"&fechaFinal="+_3b+"&fechaFinalAnterior="+_37+"&tipoServicio="+_33+"&plan="+_32+"&tipoBilateral="+_34+"&txtValorTotal="+_35+"&txtValorCuota="+_36;llamarAjax("precios_ajax.php",_3f,"advertenciasAgregarPrecio","validar_exito_guardar()");}else{$("#contenedor_error").css("display","block");$("#contenedor_error").html("Los campos marcados en rojo son obligatorios");return false;}};function validar_exito_guardar(){var _40=$("#hdd_exito").val();if(_40>0){$("#contenedor_exito_gurdar").css("display","block");$("#contenedor_exito_gurdar").html("Datos guardados correctamente");setTimeout("$('#fondo_negro_agregar_servicios').css('display', 'none'); $('#d_centro_agregar_servicios').css('display', 'none');",1000);listasPrecios();}else{$("#contenedor_error_gurdar").css("display","block");$("#contenedor_error_gurdar").html("Error al guardar precios");}};function validar_crear_precios(){var _41=0;$("#fechaInicial").removeClass("borde_error");$("#txtValorTotal").removeClass("borde_error");if($("#fechaInicial").val()==""){$("#fechaInicial").addClass("borde_error");_41=1;}if($("#txtValorTotal").val()==""){$("#txtValorTotal").addClass("borde_error");_41=1;}return _41;};function verificaGuardarPrecio(){var _42=$("#rtaAgregarPrecio").text();if(_42=="-2"){$("#contenedor_error").css("display","block");$("#contenedor_error").html("Error al guardar. Revise que la fecha del registro no este en conflicto con un registro ya creado");}else{ventanaAgregarPrecio(0,0);listasPrecios();}};function buscarServicio(){$("#frmBuscarServicioFlotante").validate({rules:{txtParametroServicio:{required:true,}},submitHandler:function(){var _43=$("#txtParametroServicio").val();var _44=$("#hdd_tipoServicio").val();var _45=$("#hdd_ecopetrol").val();var _46="opcion=6&parametro="+_43+"&tipoServicio="+_44+"&indEcopetrol="+_45;llamarAjax("precios_ajax.php",_46,"servicios","");return false;},});};function seleccionar_servicio(_47,_48){var _49=_47;$("#txtNombreServicio").html(_48);$("#hdd_idServicio").val(_49);ventanaServicios(0);};